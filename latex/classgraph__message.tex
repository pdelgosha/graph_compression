\hypertarget{classgraph__message}{}\section{graph\+\_\+message Class Reference}
\label{classgraph__message}\index{graph\+\_\+message@{graph\+\_\+message}}


this class takes care of message passing on marked graphs.  




{\ttfamily \#include $<$graph\+\_\+message.\+h$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classgraph__message_a792e738b94a19f914e5495c416defe4d}{graph\+\_\+message} (const \hyperlink{classmarked__graph}{marked\+\_\+graph} \&\hyperlink{classgraph}{graph}, int depth, int max\+\_\+degree)
\begin{DoxyCompactList}\small\item\em constructor, given reference to a graph \end{DoxyCompactList}\item 
\hyperlink{classgraph__message_aa21140453eb0e1de98a2ddfcf2832aeb}{graph\+\_\+message} ()
\begin{DoxyCompactList}\small\item\em default constructor \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
vector$<$ vector$<$ vector$<$ int $>$ $>$ $>$ \hyperlink{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}{messages}
\begin{DoxyCompactList}\small\item\em messages\mbox{[}v\mbox{]}\mbox{[}i\mbox{]}\mbox{[}t\mbox{]} is the integer version of the message at time t from vertex v towards its ith neighbor (in the order given by adj\+\_\+list of vertex i in graph G). Messages will be useful to find edge types \end{DoxyCompactList}\item 
vector$<$ vector$<$ vector$<$ int $>$ $>$ $>$ \hyperlink{classgraph__message_ab34dae49ed64132f2b1bbf626c509cd1}{inward\+\_\+messages}
\begin{DoxyCompactList}\small\item\em inward\+\_\+messages\mbox{[}v\mbox{]}\mbox{[}i\mbox{]}\mbox{[}t\mbox{]} is the integer version of the message at time t from the ith neighbor of v towards v (in the order given by adj\+\_\+list in graph G). \end{DoxyCompactList}\item 
vector$<$ unordered\+\_\+map$<$ vector$<$ int $>$, int, \hyperlink{structvint__hash}{vint\+\_\+hash} $>$ $>$ \hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\+\_\+dict}
\begin{DoxyCompactList}\small\item\em message\+\_\+dict\mbox{[}t\mbox{]} for $0 \leq t \leq h-1$ is the message dictionary at depth t, which maps each message to its corresponding index in the dictionary \end{DoxyCompactList}\item 
vector$<$ vector$<$ vector$<$ int $>$ $>$ $>$ \hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\+\_\+list}
\begin{DoxyCompactList}\small\item\em message\+\_\+list\mbox{[}t\mbox{]} is the list of messages present in the graph at depth t, stored in an order consistent with message\+\_\+dict\mbox{[}t\mbox{]}, i.\+e. for a message m, if messsage\+\_\+dict\mbox{[}t\mbox{]}\mbox{[}m\mbox{]} = i, then message\+\_\+list\mbox{[}t\mbox{]}\mbox{[}i\mbox{]} = m. This is constructed in such a way that message\+\_\+list\mbox{[}t\mbox{]}\mbox{[}message\+\_\+dict\mbox{[}t\mbox{]}\mbox{[}x\mbox{]}\mbox{]} = x. message\+\_\+list\mbox{[}h-\/1\mbox{]} is sorted in reverse order so that all $\ast$ messages (those messages starting with -\/1) go to the end of the list. Star type messages (which roughly speaking corresponds to places where there is a vertex in the h neighborhood has degree more than delta) are vectors of size 2, first coordinate being -\/1, and the second being the edge mark component (towards the \textquotesingle{}me\textquotesingle{} vertex). \end{DoxyCompactList}\item 
vector$<$ int $>$ \hyperlink{classgraph__message_a49d9af5150daf0599c29fe18cb032fa5}{message\+\_\+mark}
\begin{DoxyCompactList}\small\item\em for an integer message such as m at depth h-\/1, message\+\_\+mark\mbox{[}m\mbox{]} denotes the mark component of the message that corresponds to m. The message corresponds to m is basically message\+\_\+list\mbox{[}h-\/1\mbox{]}\mbox{[}m\mbox{]} which is of type vector$<$int$>$ and the last component in this array is the mark component. \end{DoxyCompactList}\item 
vector$<$ bool $>$ \hyperlink{classgraph__message_a55ff5531a0043106369e84a7bc45e22d}{is\+\_\+star\+\_\+message}
\begin{DoxyCompactList}\small\item\em for a message m (integer type) at depth h-\/1, is\+\_\+star\+\_\+message\mbox{[}m\mbox{]} is true if the corresponding message starts with -\/1, ans is false otherwise. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classgraph__message_a40dadc59d582b290202e79bc4a9e896c}{update\+\_\+messages} (const \hyperlink{classmarked__graph}{marked\+\_\+graph} \&)
\begin{DoxyCompactList}\small\item\em performs the message passing algorithm and updates the messages array accordingly \end{DoxyCompactList}\item 
void \hyperlink{classgraph__message_a77d137b371134e292283fdd78634f4d4}{update\+\_\+message\+\_\+dictionary} (const \hyperlink{classmarked__graph}{marked\+\_\+graph} \&)
\begin{DoxyCompactList}\small\item\em update message\+\_\+dict and message\+\_\+list \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{classgraph__message_a934d63ed7275c211e13c6fb68824ed46}{h}
\begin{DoxyCompactList}\small\item\em the depth up to which we do message passing (the type of edges go through depth h-\/1) \end{DoxyCompactList}\item 
int \hyperlink{classgraph__message_a45dfd061b7bc73572e5132fbf66efd55}{Delta}
\begin{DoxyCompactList}\small\item\em the maximum degree threshold \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
this class takes care of message passing on marked graphs. 

This graph has a reference to a \hyperlink{classmarked__graph}{marked\+\_\+graph} object for which we perform message passing to find edge types. The edge types are discovered up to depth h-\/1, and with degree parameter Delta, where h and Delta are member objects. Star type messages (which roughly speaking corresponds to places where there is a vertex in the h neighborhood has degree more than delta) are vectors of size 2, first coordinate being -\/1, and the second being the edge mark component (towards the \textquotesingle{}me\textquotesingle{} vertex).

{\itshape Sample Usage}


\begin{DoxyCode}
\hyperlink{classmarked__graph}{marked\_graph} G;
... \textcolor{comment}{//define G}
\textcolor{keywordtype}{int} h = 10;
\textcolor{keywordtype}{int} Delta = 5; 
\hyperlink{classgraph__message}{graph\_message} M(G, h, Delta);
\end{DoxyCode}
 

\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classgraph__message_a792e738b94a19f914e5495c416defe4d}\label{classgraph__message_a792e738b94a19f914e5495c416defe4d}} 
\index{graph\+\_\+message@{graph\+\_\+message}!graph\+\_\+message@{graph\+\_\+message}}
\index{graph\+\_\+message@{graph\+\_\+message}!graph\+\_\+message@{graph\+\_\+message}}
\subsubsection{\texorpdfstring{graph\+\_\+message()}{graph\_message()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily graph\+\_\+message\+::graph\+\_\+message (\begin{DoxyParamCaption}\item[{const \hyperlink{classmarked__graph}{marked\+\_\+graph} \&}]{graph,  }\item[{int}]{depth,  }\item[{int}]{max\+\_\+degree }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



constructor, given reference to a graph 


\begin{DoxyCode}
59                                                                      \{
60     \hyperlink{classgraph__message_a934d63ed7275c211e13c6fb68824ed46}{h} = depth;
61     \hyperlink{classgraph__message_a45dfd061b7bc73572e5132fbf66efd55}{Delta} = max\_degree;
62     \hyperlink{classgraph__message_a40dadc59d582b290202e79bc4a9e896c}{update\_messages}(graph); \textcolor{comment}{// do message passing}
63   \}
\end{DoxyCode}
\mbox{\Hypertarget{classgraph__message_aa21140453eb0e1de98a2ddfcf2832aeb}\label{classgraph__message_aa21140453eb0e1de98a2ddfcf2832aeb}} 
\index{graph\+\_\+message@{graph\+\_\+message}!graph\+\_\+message@{graph\+\_\+message}}
\index{graph\+\_\+message@{graph\+\_\+message}!graph\+\_\+message@{graph\+\_\+message}}
\subsubsection{\texorpdfstring{graph\+\_\+message()}{graph\_message()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily graph\+\_\+message\+::graph\+\_\+message (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



default constructor 


\begin{DoxyCode}
66 \{\}
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classgraph__message_a77d137b371134e292283fdd78634f4d4}\label{classgraph__message_a77d137b371134e292283fdd78634f4d4}} 
\index{graph\+\_\+message@{graph\+\_\+message}!update\+\_\+message\+\_\+dictionary@{update\+\_\+message\+\_\+dictionary}}
\index{update\+\_\+message\+\_\+dictionary@{update\+\_\+message\+\_\+dictionary}!graph\+\_\+message@{graph\+\_\+message}}
\subsubsection{\texorpdfstring{update\+\_\+message\+\_\+dictionary()}{update\_message\_dictionary()}}
{\footnotesize\ttfamily void graph\+\_\+message\+::update\+\_\+message\+\_\+dictionary (\begin{DoxyParamCaption}\item[{const \hyperlink{classmarked__graph}{marked\+\_\+graph} \&}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



update message\+\_\+dict and message\+\_\+list 

\mbox{\Hypertarget{classgraph__message_a40dadc59d582b290202e79bc4a9e896c}\label{classgraph__message_a40dadc59d582b290202e79bc4a9e896c}} 
\index{graph\+\_\+message@{graph\+\_\+message}!update\+\_\+messages@{update\+\_\+messages}}
\index{update\+\_\+messages@{update\+\_\+messages}!graph\+\_\+message@{graph\+\_\+message}}
\subsubsection{\texorpdfstring{update\+\_\+messages()}{update\_messages()}}
{\footnotesize\ttfamily void graph\+\_\+message\+::update\+\_\+messages (\begin{DoxyParamCaption}\item[{const \hyperlink{classmarked__graph}{marked\+\_\+graph} \&}]{G }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



performs the message passing algorithm and updates the messages array accordingly 

The structure of messages is as follows. To simplify the notation, we use $M_k(v,w)$ to denote the message sent from $v$ towards $w$ at time step $k$, this is in fact messages\mbox{[}v\mbox{]}\mbox{[}i\mbox{]}\mbox{[}t\mbox{]} where i is the index of $w$ among neighbors of $v$.


\begin{DoxyItemize}
\item For $k = 0$, we have $M_0(v,w) = (\tau_G(v), 0,\xi_G(w,v))$ where $\tau_G(v)$ is the mark of vertex $v$ and $\xi_G(w,v)$ denotes the mark of the edge between $v$ and $w$ towards $v$.
\item For $k > 0$, if the degree of $v$ is bigger than Delta, we have $M_k(v,w) = (-1,\xi_G(w,v))$.
\item Otherwise, we form the list $(s_u: u \sim_G v, u \neq w)$, where for $u \sim_G v, u \neq w$, we set $s_u = (M_{k-1}(u,v), \xi_G(u,v))$.
\item If for some $u \sim_G v, u \neq w$, the sequence $s_u$ starts with a -\/1, we set $M_k(v,w) = (-1,\xi_G(w,v))$.
\item Otherwise, we sort the sequences $s_u$ nondecreasingly with respect to the lexicographic order and set $s$ to be the concatenation of the sorted list. Finally, we set $M_k(v,w) = (\tau_G(v), \deg_G(v) -1, s, \xi_G(w,v))$. 
\end{DoxyItemize}
\begin{DoxyCode}
24 \{
25   \hyperlink{classlogger_a9d29b49bd318a719a8e85b59eac54fe0}{logger::current\_depth}++;
26   \hyperlink{classlogger_a710163deb17bc81f70d53d285b8ac9ac}{logger::add\_entry}(\textcolor{stringliteral}{"graph\_message::update\_message init"}, \textcolor{stringliteral}{""});
27   \textcolor{keywordtype}{int} nu\_vertices = G.\hyperlink{classmarked__graph_acf79c6aeb8f32614cb14a5baaa6c9f9b}{nu\_vertices};
28   \textcolor{keywordtype}{int} w;
29   \textcolor{keywordtype}{int} my\_location;
30   \hyperlink{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}{messages}.resize(nu\_vertices);
31   \textcolor{comment}{//inward\_message.resize(nu\_vertices);}
32   \hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\_dict}.resize(\hyperlink{classgraph__message_a934d63ed7275c211e13c6fb68824ed46}{h});
33   \hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}.resize(\hyperlink{classgraph__message_a934d63ed7275c211e13c6fb68824ed46}{h});
34 
35   \textcolor{comment}{// initialize the messages}
36 
37   \hyperlink{classlogger_a710163deb17bc81f70d53d285b8ac9ac}{logger::add\_entry}(\textcolor{stringliteral}{"resizing messages"}, \textcolor{stringliteral}{""});
38   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} v=0;v<nu\_vertices;v++)\{
39     \hyperlink{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}{messages}[v].resize(G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v].size());
40     \textcolor{comment}{//inward\_messages[v].resize(G.adj\_list[v].size());}
41     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0;i<G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v].size();i++)\{
42       \hyperlink{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}{messages}[v][i].resize(\hyperlink{classgraph__message_a934d63ed7275c211e13c6fb68824ed46}{h});
43       \textcolor{comment}{//inward\_messages[v][i].resize(h);}
44     \}
45   \}
46 
47   \hyperlink{classlogger_a710163deb17bc81f70d53d285b8ac9ac}{logger::add\_entry}(\textcolor{stringliteral}{"initializing messages"},\textcolor{stringliteral}{""});
48   vector<int> m(3);
49   unordered\_map<vector<int>, int, \hyperlink{structvint__hash}{vint\_hash}>::iterator it;
50   \textcolor{comment}{//map<vector<int>, int>::iterator it;}
51 
52   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} v=0;v<nu\_vertices;v++)\{
53 
54     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0;i<G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v].size();i++)\{
55       \textcolor{comment}{// the message from v towards the ith neighbor (lets call is w) at time 0 has a mark component which
       is \(\backslash\)xi(v,w) and a subtree component which is a single root with mark \(\backslash\)tau(v). This is encoded as a message
       vector with size 3 of the form (\(\backslash\)tau(v), 0,\(\backslash\)xi(v,w)) where the last 0 indicates that there is no offspring.}
56 
57 
58       \textcolor{comment}{//vector<int> m;}
59       \textcolor{comment}{//m.clear();}
60       \textcolor{comment}{//m.push\_back(G.ver\_mark[v]);}
61       \textcolor{comment}{//m.push\_back(0);}
62       \textcolor{comment}{//m.push\_back(G.adj\_list[v][i].second.first);}
63 
64       m[0] = G.\hyperlink{classmarked__graph_ac83e9377dd4d8bb95be1ac949b127296}{ver\_mark}[v];
65       m[1] = 0;
66       m[2] = G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v][i].second.first;
67 
68       \textcolor{comment}{// adding this message to the message dictionary}
69       it = \hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\_dict}[0].find(m);
70       w = G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v][i].first;
71       \textcolor{keywordflow}{if} (it == \hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\_dict}[0].end())\{
72         \hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\_dict}[0][m] = \hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[0].size();
73         \hyperlink{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}{messages}[v][i][0] = \hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[0].size();
74         \hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[0].push\_back(m);
75 
76       \}\textcolor{keywordflow}{else}\{
77         \hyperlink{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}{messages}[v][i][0] = it->second;
78       \}
79 
80       \textcolor{comment}{//messages[v][i][0] = message\_dict[0][m]; // the message at time 0}
81     \}
82   \}
83 
84   \textcolor{comment}{// updating messages}
85   \hyperlink{classlogger_a710163deb17bc81f70d53d285b8ac9ac}{logger::add\_entry}(\textcolor{stringliteral}{"updating messages"}, \textcolor{stringliteral}{""});
86   m.reserve(5+ 2 * \hyperlink{classgraph__message_a45dfd061b7bc73572e5132fbf66efd55}{Delta});
87 
88   duration<float> diff;
89   high\_resolution\_clock::time\_point t1, t2; 
90   \textcolor{keywordtype}{float} agg\_search = 0;
91   \textcolor{keywordtype}{float} agg\_insert = 0;
92   \textcolor{keywordtype}{float} agg\_m = 0;
93   \textcolor{keywordtype}{float} agg\_sort = 0;
94   \textcolor{keywordtype}{float} agg\_neigh\_message = 0;
95 
96   vector<pair<pair<int, int>, \textcolor{keywordtype}{int}> > neighbor\_messages; \textcolor{comment}{// the first component is the message and the
       second is the name of the neighbor}
97   \textcolor{comment}{// the second component is stored so that after sorting, we know the owner of the message}
98   neighbor\_messages.reserve(5+2*\hyperlink{classgraph__message_a45dfd061b7bc73572e5132fbf66efd55}{Delta});
99 
100   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} t=1;t<\hyperlink{classgraph__message_a934d63ed7275c211e13c6fb68824ed46}{h};t++)\{
101     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} v=0;v<nu\_vertices;v++)\{
102       \textcolor{comment}{//cerr << " vertex " << v << endl;}
103       \textcolor{keywordflow}{if} (G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v].size() <= \hyperlink{classgraph__message_a45dfd061b7bc73572e5132fbf66efd55}{Delta})\{
104         \textcolor{comment}{// the degree of v is no more than Delta}
105         \textcolor{comment}{// do the standard message passing by aggregating messages from neighbors}
106         \textcolor{comment}{// stacking all the messages from neighbors of v towards v}
107         neighbor\_messages.clear();
108 
109         \textcolor{comment}{// the message from each neighbor of v, say w,  towards v is considered, the mark of the edge
       between w and v towards v is added to it, and then all these objects are stacked in neighbor\_messages to be
       sorted and used afterwards}
110         t1 = high\_resolution\_clock::now();
111         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0;i<G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v].size();i++)\{
112           w = G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v][i].first; \textcolor{comment}{// what is the name of the neighbor I am looking at now,
       which is the ith neighbor of vertex v }
113           \textcolor{comment}{//my\_location = G.adj\_location[w].at(v); <--- the inefficient way}
114           my\_location = G.\hyperlink{classmarked__graph_aee10b537408de42476609c1e45c075d0}{index\_in\_neighbor}[v][i];
115           \textcolor{comment}{// where is the place of node v among the list of neighbors of the ith neighbor of v}
116           \textcolor{keywordtype}{int} previous\_message = \hyperlink{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}{messages}[w][my\_location][t-1]; \textcolor{comment}{// the message sent from this
       neighbor towards v at time t-1}
117           \textcolor{keywordtype}{int} mark\_to\_v = G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v][i].second.first;
118           neighbor\_messages.push\_back(pair<pair<int, int> , \textcolor{keywordtype}{int}> (pair<int,int>(previous\_message, mark\_to\_v
      ), w));
119         \}
120         t2 = high\_resolution\_clock::now();
121         diff = t2 - t1;
122         agg\_neigh\_message += diff.count();
123 
124         t1 = high\_resolution\_clock::now();
125         sort(neighbor\_messages.begin(), neighbor\_messages.end()); \textcolor{comment}{// sorts lexicographically}
126         t2 = high\_resolution\_clock::now();
127         diff = t2 - t1;
128         agg\_sort += diff.count();
129 
130         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0;i<G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v].size();i++)\{
131           \textcolor{comment}{// let w be the current ith neighbor of v}
132           \textcolor{keywordtype}{int} w = G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v][i].first;
133           \textcolor{comment}{// first, start with the mark of v and the number of offsprings in the subgraph component of the
       message}
134           \textcolor{comment}{//vector<int> m; // the message that v is going to send to w}
135           t1 = high\_resolution\_clock::now();
136           m.clear();
137           m.push\_back(G.\hyperlink{classmarked__graph_ac83e9377dd4d8bb95be1ac949b127296}{ver\_mark}[v]); \textcolor{comment}{// mark of v}
138           m.push\_back(G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v].size()-1); \textcolor{comment}{// the number of offsprings in the subgraph
       component of the message}
139           t2 = high\_resolution\_clock::now();
140           diff = t2 - t1;
141           agg\_m += diff.count();
142 
143           \textcolor{comment}{// stacking messages from all neighbors of v expect for w towards v at time t-1}
144           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j=0;j<G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v].size();j++)\{
145             \textcolor{keywordflow}{if} (neighbor\_messages[j].second != w)\{
146               \textcolor{keywordflow}{if} (\hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[t-1][neighbor\_messages[j].first.first][0] == -1)\{
147                 \textcolor{comment}{// this means that one of the messages that should be aggregated is * typed, therefore the
       outgoing messages should also be * typed}
148                 \textcolor{comment}{// i.e. the message has only two entries: (-1, \(\backslash\)xi(w,v)) where \(\backslash\)xi(w,v) is the mark of the
       edge between v and w towards v}
149                 \textcolor{comment}{// since after this loop, the mark \(\backslash\)xi(w,v) is added to the message (after the comment
       starting with 'finally'), we only add the initial -1 part}
150                 t1 = high\_resolution\_clock::now();
151                 m.resize(0);
152                 m.push\_back(-1);
153                 t2 = high\_resolution\_clock::now();
154                 diff = t2 - t1;
155                 agg\_m += diff.count();
156                 \textcolor{keywordflow}{break}; \textcolor{comment}{// the message is decided, we do not need to go over any of the other neighbor
       messages, hence break}
157               \}
158               \textcolor{comment}{// this message should be added to the list of messages}
159               t1 = high\_resolution\_clock::now();
160               m.push\_back(neighbor\_messages[j].first.first); \textcolor{comment}{// message part}
161               m.push\_back(neighbor\_messages[j].first.second); \textcolor{comment}{// mark part towards v}
162               t2 = high\_resolution\_clock::now();
163               diff = t2 - t1;
164               agg\_m += diff.count();
165 
166             \}
167           \}
168           \textcolor{comment}{// if we break, we reach at this point and message is (-1), otherwise the message is of the form
       (\(\backslash\)tau(v), \(\backslash\)deg(v) - 1, ...) where ... is the list of all neighbor messages towards v except for w. }
169           \textcolor{comment}{// finally, the mark of the edge between v and w towards v, \(\backslash\)xi(w,v), should be added to this
       list}
170           t1 = high\_resolution\_clock::now();
171           m.push\_back(G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v][i].second.first);
172           t2 = high\_resolution\_clock::now();
173           diff = t2 - t1;
174           agg\_m += diff.count();
175 
176           \textcolor{comment}{// set the current message}
177           t1 = high\_resolution\_clock::now();
178           it = \hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\_dict}[t].find(m);
179           t2 = high\_resolution\_clock::now();
180           diff = t2 - t1;
181           agg\_search += diff.count();
182 
183           \textcolor{keywordflow}{if} (it == \hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\_dict}[t].end())\{
184             t1 = high\_resolution\_clock::now();
185             \textcolor{comment}{//message\_dict[t][m] = message\_list[t].size();}
186             \hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\_dict}[t].insert(pair<vector<int>, \textcolor{keywordtype}{int}> (m, 
      \hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[t].size()));
187             t2 = high\_resolution\_clock::now();
188             diff = t2 - t1;
189             agg\_insert += diff.count();
190 
191             \hyperlink{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}{messages}[v][i][t] = \hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[t].size();
192             \hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[t].push\_back(m);
193           \}\textcolor{keywordflow}{else}\{
194             \hyperlink{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}{messages}[v][i][t] = it->second;
195           \}
196         \}
197       \}\textcolor{keywordflow}{else}\{
198         \textcolor{comment}{// if the degree of v is bigger than Delta, the message towards all neighbors is of the form *}
199         \textcolor{comment}{// i.e. message of v towards a neighbor w is of the form (-1, \(\backslash\)xi(w,v)) where \(\backslash\)xi(w,v) is the mark
       of the edge between v and w towards v}
200         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0;i<G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v].size();i++)\{
201           \textcolor{comment}{//vector<int> m; // the current message from v to ith neighbor}
202           t1 = high\_resolution\_clock::now();
203           m.clear();
204           m.resize(2);
205           m[0] = -1;
206           m[1] = G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v][i].second.first;
207           t2 = high\_resolution\_clock::now();
208           diff = t2 - t1;
209           agg\_m += diff.count();
210 
211           \textcolor{comment}{// set the current message}
212           t1 = high\_resolution\_clock::now();
213           it = \hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\_dict}[t].find(m);
214           t2 = high\_resolution\_clock::now();
215           diff = t2 - t1;
216           agg\_search += diff.count();
217 
218           \textcolor{keywordflow}{if} (it == \hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\_dict}[t].end())\{
219             t1 = high\_resolution\_clock::now();
220             \textcolor{comment}{//message\_dict[t][m] = message\_list[t].size();}
221             \hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\_dict}[t].insert(pair<vector<int>, \textcolor{keywordtype}{int}> (m, 
      \hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[t].size()));
222             t2 = high\_resolution\_clock::now();
223             diff = t2 - t1;
224             agg\_insert += diff.count();
225             \hyperlink{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}{messages}[v][i][t] = \hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[t].size();
226             \hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[t].push\_back(m);
227           \}\textcolor{keywordflow}{else}\{
228             \hyperlink{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}{messages}[v][i][t] = it->second;
229           \}
230         \}
231       \}
232     \}
233   \}
234   cerr << \textcolor{stringliteral}{" total time to search in hash table: "} << agg\_search << endl;
235   cerr << \textcolor{stringliteral}{" total time to insert in hash table: "} << agg\_insert << endl;
236   cerr << \textcolor{stringliteral}{" total time to modify vector m  "} << agg\_m << endl;
237   cerr << \textcolor{stringliteral}{" total time to sort  "} << agg\_sort << endl;
238   cerr << \textcolor{stringliteral}{" total time to collect neighbor messages "} <<  agg\_neigh\_message << endl;
239   \textcolor{comment}{// now, we should update messages at time h-1 so that if the message from v to w is *, i.e. is of the
       form (-1,x), then the message from w to v is also of the similar form, i.e. it is (-1,x') where x' = \(\backslash\)xi(v,w)}
240   \hyperlink{classlogger_a710163deb17bc81f70d53d285b8ac9ac}{logger::add\_entry}(\textcolor{stringliteral}{"* symmetrizing"}, \textcolor{stringliteral}{""});
241   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} v=0;v<nu\_vertices;v++)\{
242     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0;i<G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v].size();i++)\{
243       \textcolor{keywordflow}{if} (\hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[h-1][\hyperlink{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}{messages}[v][i][h-1]][0] == -1)\{
244         \textcolor{comment}{// it is of the form *}
245         \textcolor{keywordtype}{int} w = G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v][i].first; \textcolor{comment}{// the other endpoint of the edge}
246         \textcolor{keywordtype}{int} my\_location = G.\hyperlink{classmarked__graph_a3ae722ea9583ad23af34d789a88ac01a}{adj\_location}[w].at(v); \textcolor{comment}{// so that adj\_list[w][my\_location].first =
       v}
247         \textcolor{comment}{//vector<int> m;}
248         m.clear();
249         m.resize(2);
250         m[0] = -1;
251         m[1] = G.\hyperlink{classmarked__graph_a1a0bf7ca413a278763f7c878b3b6fd6f}{adj\_list}[v][i].second.second; \textcolor{comment}{// the mark towards w}
252         \textcolor{keywordflow}{if} (\hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\_dict}[h-1].find(m) == \hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\_dict}[h-1].end())\{
253           \hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\_dict}[h-1][m] = \hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[h-1].size();
254           \hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[h-1].push\_back(m);
255         \}
256         \hyperlink{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}{messages}[w][my\_location][h-1] = \hyperlink{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}{message\_dict}[h-1][m];
257       \}
258     \}
259   \}
260 
261   \textcolor{comment}{// setting message\_mark and is\_star\_message}
262   \hyperlink{classlogger_a710163deb17bc81f70d53d285b8ac9ac}{logger::add\_entry}(\textcolor{stringliteral}{"setting message\_mark and is\_star\_message"}, \textcolor{stringliteral}{""});
263   \hyperlink{classgraph__message_a49d9af5150daf0599c29fe18cb032fa5}{message\_mark}.resize(\hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[h-1].size());
264   \hyperlink{classgraph__message_a55ff5531a0043106369e84a7bc45e22d}{is\_star\_message}.resize(\hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[h-1].size());
265   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0;i<\hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[h-1].size();i++)\{
266     \hyperlink{classgraph__message_a49d9af5150daf0599c29fe18cb032fa5}{message\_mark}[i] = \hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[h-1][i].back(); \textcolor{comment}{// the last element is the mark
       component}
267     \hyperlink{classgraph__message_a55ff5531a0043106369e84a7bc45e22d}{is\_star\_message}[i] = (\hyperlink{classgraph__message_aa17fdb629b423343edfafa97252763ef}{message\_list}[h-1][i][0] == -1); \textcolor{comment}{// message is star
       type when the first element is -1}
268   \}
269   \hyperlink{classlogger_a9d29b49bd318a719a8e85b59eac54fe0}{logger::current\_depth}--;
270 \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classgraph__message_a45dfd061b7bc73572e5132fbf66efd55}\label{classgraph__message_a45dfd061b7bc73572e5132fbf66efd55}} 
\index{graph\+\_\+message@{graph\+\_\+message}!Delta@{Delta}}
\index{Delta@{Delta}!graph\+\_\+message@{graph\+\_\+message}}
\subsubsection{\texorpdfstring{Delta}{Delta}}
{\footnotesize\ttfamily int graph\+\_\+message\+::\+Delta\hspace{0.3cm}{\ttfamily [private]}}



the maximum degree threshold 

\mbox{\Hypertarget{classgraph__message_a934d63ed7275c211e13c6fb68824ed46}\label{classgraph__message_a934d63ed7275c211e13c6fb68824ed46}} 
\index{graph\+\_\+message@{graph\+\_\+message}!h@{h}}
\index{h@{h}!graph\+\_\+message@{graph\+\_\+message}}
\subsubsection{\texorpdfstring{h}{h}}
{\footnotesize\ttfamily int graph\+\_\+message\+::h\hspace{0.3cm}{\ttfamily [private]}}



the depth up to which we do message passing (the type of edges go through depth h-\/1) 

\mbox{\Hypertarget{classgraph__message_ab34dae49ed64132f2b1bbf626c509cd1}\label{classgraph__message_ab34dae49ed64132f2b1bbf626c509cd1}} 
\index{graph\+\_\+message@{graph\+\_\+message}!inward\+\_\+messages@{inward\+\_\+messages}}
\index{inward\+\_\+messages@{inward\+\_\+messages}!graph\+\_\+message@{graph\+\_\+message}}
\subsubsection{\texorpdfstring{inward\+\_\+messages}{inward\_messages}}
{\footnotesize\ttfamily vector$<$vector$<$vector$<$int $>$ $>$ $>$ graph\+\_\+message\+::inward\+\_\+messages}



inward\+\_\+messages\mbox{[}v\mbox{]}\mbox{[}i\mbox{]}\mbox{[}t\mbox{]} is the integer version of the message at time t from the ith neighbor of v towards v (in the order given by adj\+\_\+list in graph G). 

\mbox{\Hypertarget{classgraph__message_a55ff5531a0043106369e84a7bc45e22d}\label{classgraph__message_a55ff5531a0043106369e84a7bc45e22d}} 
\index{graph\+\_\+message@{graph\+\_\+message}!is\+\_\+star\+\_\+message@{is\+\_\+star\+\_\+message}}
\index{is\+\_\+star\+\_\+message@{is\+\_\+star\+\_\+message}!graph\+\_\+message@{graph\+\_\+message}}
\subsubsection{\texorpdfstring{is\+\_\+star\+\_\+message}{is\_star\_message}}
{\footnotesize\ttfamily vector$<$bool$>$ graph\+\_\+message\+::is\+\_\+star\+\_\+message}



for a message m (integer type) at depth h-\/1, is\+\_\+star\+\_\+message\mbox{[}m\mbox{]} is true if the corresponding message starts with -\/1, ans is false otherwise. 

\mbox{\Hypertarget{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}\label{classgraph__message_ab54d89b122c2b1322da0d5db2043fb84}} 
\index{graph\+\_\+message@{graph\+\_\+message}!message\+\_\+dict@{message\+\_\+dict}}
\index{message\+\_\+dict@{message\+\_\+dict}!graph\+\_\+message@{graph\+\_\+message}}
\subsubsection{\texorpdfstring{message\+\_\+dict}{message\_dict}}
{\footnotesize\ttfamily vector$<$unordered\+\_\+map$<$vector$<$int$>$, int, \hyperlink{structvint__hash}{vint\+\_\+hash}$>$ $>$ graph\+\_\+message\+::message\+\_\+dict}



message\+\_\+dict\mbox{[}t\mbox{]} for $0 \leq t \leq h-1$ is the message dictionary at depth t, which maps each message to its corresponding index in the dictionary 

\mbox{\Hypertarget{classgraph__message_aa17fdb629b423343edfafa97252763ef}\label{classgraph__message_aa17fdb629b423343edfafa97252763ef}} 
\index{graph\+\_\+message@{graph\+\_\+message}!message\+\_\+list@{message\+\_\+list}}
\index{message\+\_\+list@{message\+\_\+list}!graph\+\_\+message@{graph\+\_\+message}}
\subsubsection{\texorpdfstring{message\+\_\+list}{message\_list}}
{\footnotesize\ttfamily vector$<$vector$<$vector$<$int$>$ $>$ $>$ graph\+\_\+message\+::message\+\_\+list}



message\+\_\+list\mbox{[}t\mbox{]} is the list of messages present in the graph at depth t, stored in an order consistent with message\+\_\+dict\mbox{[}t\mbox{]}, i.\+e. for a message m, if messsage\+\_\+dict\mbox{[}t\mbox{]}\mbox{[}m\mbox{]} = i, then message\+\_\+list\mbox{[}t\mbox{]}\mbox{[}i\mbox{]} = m. This is constructed in such a way that message\+\_\+list\mbox{[}t\mbox{]}\mbox{[}message\+\_\+dict\mbox{[}t\mbox{]}\mbox{[}x\mbox{]}\mbox{]} = x. message\+\_\+list\mbox{[}h-\/1\mbox{]} is sorted in reverse order so that all $\ast$ messages (those messages starting with -\/1) go to the end of the list. Star type messages (which roughly speaking corresponds to places where there is a vertex in the h neighborhood has degree more than delta) are vectors of size 2, first coordinate being -\/1, and the second being the edge mark component (towards the \textquotesingle{}me\textquotesingle{} vertex). 

\mbox{\Hypertarget{classgraph__message_a49d9af5150daf0599c29fe18cb032fa5}\label{classgraph__message_a49d9af5150daf0599c29fe18cb032fa5}} 
\index{graph\+\_\+message@{graph\+\_\+message}!message\+\_\+mark@{message\+\_\+mark}}
\index{message\+\_\+mark@{message\+\_\+mark}!graph\+\_\+message@{graph\+\_\+message}}
\subsubsection{\texorpdfstring{message\+\_\+mark}{message\_mark}}
{\footnotesize\ttfamily vector$<$int$>$ graph\+\_\+message\+::message\+\_\+mark}



for an integer message such as m at depth h-\/1, message\+\_\+mark\mbox{[}m\mbox{]} denotes the mark component of the message that corresponds to m. The message corresponds to m is basically message\+\_\+list\mbox{[}h-\/1\mbox{]}\mbox{[}m\mbox{]} which is of type vector$<$int$>$ and the last component in this array is the mark component. 

\mbox{\Hypertarget{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}\label{classgraph__message_aac77e098f0acf9650116a8e51fe3b4b7}} 
\index{graph\+\_\+message@{graph\+\_\+message}!messages@{messages}}
\index{messages@{messages}!graph\+\_\+message@{graph\+\_\+message}}
\subsubsection{\texorpdfstring{messages}{messages}}
{\footnotesize\ttfamily vector$<$vector$<$vector$<$int $>$ $>$ $>$ graph\+\_\+message\+::messages}



messages\mbox{[}v\mbox{]}\mbox{[}i\mbox{]}\mbox{[}t\mbox{]} is the integer version of the message at time t from vertex v towards its ith neighbor (in the order given by adj\+\_\+list of vertex i in graph G). Messages will be useful to find edge types 



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
\hyperlink{graph__message_8h}{graph\+\_\+message.\+h}\item 
\hyperlink{graph__message_8cpp}{graph\+\_\+message.\+cpp}\end{DoxyCompactItemize}
