<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="/Users/pdelgosha/css/jemdoc_edited.css" type="text/css" />
  <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</head>
<body>
<div id="TOC">
<ul>
<li><a href="#discussions">Discussions</a><ul>
<li><a href="#section">2019-04-08</a></li>
<li><a href="#pm">2019-04-09 8:53 PM</a></li>
<li><a href="#pm-1">2019-04-09 9:17 PM</a></li>
<li><a href="#am">2019-04-10 11:50 AM</a></li>
<li><a href="#pm-2">2019-04-12 7:04 PM</a></li>
<li><a href="#pm-3">2019-04-12 7:12 PM</a></li>
<li><a href="#pm-4">2019-04-16 5:40 PM</a></li>
</ul></li>
</ul>
</div>
<h1 id="discussions">Discussions</h1>
<h2 id="section">2019-04-08</h2>
<p>Improved MP by avoiding doing things twice. Since the commit of 3/13 (8642e59), I have made the following modifications:</p>
<ol style="list-style-type: decimal">
<li>Instead of using binary search tree for <code>message_dict</code>, a hash table is used to improved the speed.</li>
<li>Avoid doing things multiple times: when a message is fond in the dictionary, instead of using the bracket operator to assign the corresponding message, one can use an iterator that is helpful in both checking whether the message exists in the dictionary and also this assignment.</li>
</ol>
<p>With these modifications, here is the result running time of the algorithm when applied to a Poisson random graph with 100,000 nodes, edge and vertex mark set size = 10, and average number of nodes connected to every vertex = 3 (average degree would be 6), h = 3, delta = 20:</p>
<p><details> <summary> Click here to open </summary></p>
<pre><code>|---Construct G () 2019-04-08 07:37:02 PM
 edges size 300041
 graph constructed
|---Encode () 2019-04-08 07:37:03 PM
|---|---Init compressed () 2019-04-08 07:37:03 PM
|---|---Extact edge types () 2019-04-08 07:37:03 PM
|---|---|---Extract messages () 2019-04-08 07:37:03 PM
|---|---|---|---graph_message::update_message init () 2019-04-08 07:37:03 PM
|---|---|---|---resizing messages () 2019-04-08 07:37:03 PM
|---|---|---|---initializing messages () 2019-04-08 07:37:03 PM
|---|---|---|---updating messages () 2019-04-08 07:37:03 PM
 total time to search in hash table: 0.769341
 total time to insert in hash table: 1.53727
 total time to modify vector m  0.799577
 total time to sort  0.0696137
|---|---|---|---* symmetrizing () 2019-04-08 07:37:09 PM
|---|---|---|---setting message_mark and is_star_message () 2019-04-08 07:37:09 PM
|---|---|---colored_graph::init init () 2019-04-08 07:37:09 PM
|---|---|---updating adj_list () 2019-04-08 07:37:10 PM
|---|---|---Find deg and ver_types () 2019-04-08 07:37:10 PM
|---|---Encode * vertices () 2019-04-08 07:37:11 PM
|---|---Encode * edges () 2019-04-08 07:37:14 PM
|---|---Encode vertex types () 2019-04-08 07:37:14 PM
|---|---Extract partition graphs () 2019-04-08 07:37:16 PM
|---|---Encode partition b graphs () 2019-04-08 07:37:19 PM
|---|---Encode partition graphs () 2019-04-08 07:37:21 PM
|---Decode () 2019-04-08 07:37:21 PM
|---|---Init () 2019-04-08 07:37:21 PM
|---|---Decode * vertices () 2019-04-08 07:37:21 PM
|---|---Decode * edges () 2019-04-08 07:37:24 PM
|---|---Decode vertex types () 2019-04-08 07:37:24 PM
|---|---Decode partition graphs () 2019-04-08 07:37:30 PM
|---|---Decode partition b graphs () 2019-04-08 07:37:30 PM
|---|---Construct decoded graph () 2019-04-08 07:37:34 PM
|---compare () 2019-04-08 07:37:35 PM
 successfully decoded the marked graph :D

|---Construct G (): 1.007256s [2.847803%]
|---Encode (): 18.077404s [51.110016%]
|---|---Init compressed (): 0.000786s [0.004350%]
|---|---Extact edge types (): 8.238246s [45.572063%]
|---|---|---Extract messages (): 6.366953s [77.285301%]
|---|---|---|---graph_message::update_message init (): 0.001501s [0.023580%]
|---|---|---|---resizing messages (): 0.177938s [2.794706%]
|---|---|---|---initializing messages (): 0.182283s [2.862949%]
|---|---|---|---updating messages (): 5.933976s [93.199608%]
|---|---|---|---* symmetrizing (): 0.035266s [0.553898%]
|---|---|---|---setting message_mark and is_star_message (): 0.035971s [0.564971%]
|---|---|---colored_graph::init init (): 0.224685s [2.727335%]
|---|---|---updating adj_list (): 0.393801s [4.780152%]
|---|---|---Find deg and ver_types (): 1.252763s [15.206671%]
|---|---Encode * vertices (): 2.368763s [13.103448%]
|---|---Encode * edges (): 0.000043s [0.000240%]
|---|---Encode vertex types (): 2.317106s [12.817693%]
|---|---Extract partition graphs (): 2.823593s [15.619463%]
|---|---Encode partition b graphs (): 2.143847s [11.859265%]
|---|---Encode partition graphs (): 0.182942s [1.011993%]
|---Decode (): 13.384299s [37.841259%]
|---|---Init (): 0.000024s [0.000179%]
|---|---Decode * vertices (): 2.418280s [18.068033%]
|---|---Decode * edges (): 0.000034s [0.000256%]
|---|---Decode vertex types (): 6.676574s [49.883629%]
|---|---Decode partition graphs (): 0.000054s [0.000400%]
|---|---Decode partition b graphs (): 3.761533s [28.104073%]
|---|---Construct decoded graph (): 0.527769s [3.943198%]
|---compare (): 2.900620s [8.200886%]
       35.38 real        33.98 user         0.73 sys</code></pre>
<p></details></p>
<p>Here, extracting edge types takes 45% of the compression time, and updating messages takes 93% of extracting edge types. Updating messages takes 5.9s, among which 0.76s is for search in hash table, 1.5s is for insertion in hash table, and 0.8s for modifying vector m (the message vector). This totals to 3s, yet 2.9s remains which is not clear what happens. Maybe I should do a more search on this. I also thought of updating messages parallel since updating for different nodes are independent. So I spent some time last week to learn multi thread programming in C++.</p>
<h2 id="pm">2019-04-09 8:53 PM</h2>
<p>Realized that in updating messages, the variable <code>neighbor_messages</code> is defined in each iteration of the loop. I defined it outside the loop, reserved some space for it, and cleared it inside the loop. This made some improvement (around 0.1 - 0.2 s):</p>
<p><details> <summary> before </summary></p>
<pre><code>---Construct G () 2019-04-09 05:03:30 PM
 edges size 299475
 graph constructed
|---Encode () 2019-04-09 05:03:31 PM
|---|---Init compressed () 2019-04-09 05:03:31 PM
|---|---Extact edge types () 2019-04-09 05:03:31 PM
|---|---|---Extract messages () 2019-04-09 05:03:31 PM
|---|---|---|---graph_message::update_message init () 2019-04-09 05:03:31 PM
|---|---|---|---resizing messages () 2019-04-09 05:03:31 PM
|---|---|---|---initializing messages () 2019-04-09 05:03:31 PM
|---|---|---|---updating messages () 2019-04-09 05:03:31 PM
 total time to search in hash table: 0.76763
 total time to insert in hash table: 1.55482
 total time to modify vector m  0.801063
 total time to sort  0.0744823
 total time to collect neighbor messages 1.05781
|---|---|---|---* symmetrizing () 2019-04-09 05:03:37 PM
|---|---|---|---setting message_mark and is_star_message () 2019-04-09 05:03:37 PM
|---|---|---colored_graph::init init () 2019-04-09 05:03:37 PM
|---|---|---updating adj_list () 2019-04-09 05:03:37 PM
|---|---|---Find deg and ver_types () 2019-04-09 05:03:38 PM
|---|---Encode * vertices () 2019-04-09 05:03:39 PM
|---|---Encode * edges () 2019-04-09 05:03:41 PM
|---|---Encode vertex types () 2019-04-09 05:03:41 PM
|---|---Extract partition graphs () 2019-04-09 05:03:44 PM
|---|---Encode partition b graphs () 2019-04-09 05:03:46 PM
|---|---Encode partition graphs () 2019-04-09 05:03:48 PM
|---Decode () 2019-04-09 05:03:49 PM
|---|---Init () 2019-04-09 05:03:49 PM
|---|---Decode * vertices () 2019-04-09 05:03:49 PM
|---|---Decode * edges () 2019-04-09 05:03:51 PM
|---|---Decode vertex types () 2019-04-09 05:03:51 PM
|---|---Decode partition graphs () 2019-04-09 05:03:57 PM
|---|---Decode partition b graphs () 2019-04-09 05:03:57 PM
|---|---Construct decoded graph () 2019-04-09 05:04:01 PM
|---compare () 2019-04-09 05:04:01 PM
 successfully decoded the marked graph :D

|---Construct G (): 0.945466s [2.729596%]
|---Encode (): 17.966131s [51.868896%]
|---|---Init compressed (): 0.000691s [0.003846%]
|---|---Extact edge types (): 8.346380s [46.456192%]
|---|---|---Extract messages (): 6.465446s [77.464073%]
|---|---|---|---graph_message::update_message init (): 0.001417s [0.021923%]
|---|---|---|---resizing messages (): 0.199745s [3.089419%]
|---|---|---|---initializing messages (): 0.187164s [2.894831%]
|---|---|---|---updating messages (): 6.012073s [92.987755%]
|---|---|---|---* symmetrizing (): 0.030768s [0.475881%]
|---|---|---|---setting message_mark and is_star_message (): 0.034264s [0.529948%]
|---|---|---colored_graph::init init (): 0.225783s [2.705163%]
|---|---|---updating adj_list (): 0.389235s [4.663514%]
|---|---|---Find deg and ver_types (): 1.265874s [15.166743%]
|---|---Encode * vertices (): 2.294833s [12.773107%]
|---|---Encode * edges (): 0.000052s [0.000290%]
|---|---Encode vertex types (): 2.315811s [12.889873%]
|---|---Extract partition graphs (): 2.749254s [15.302428%]
|---|---Encode partition b graphs (): 2.082472s [11.591098%]
|---|---Encode partition graphs (): 0.174702s [0.972397%]
|---Decode (): 12.768882s [36.864243%]
|---|---Init (): 0.000014s [0.000111%]
|---|---Decode * vertices (): 2.372627s [18.581320%]
|---|---Decode * edges (): 0.000034s [0.000268%]
|---|---Decode vertex types (): 6.345600s [49.695812%]
|---|---Decode partition graphs (): 0.000051s [0.000399%]
|---|---Decode partition b graphs (): 3.525432s [27.609560%]
|---|---Construct decoded graph (): 0.525092s [4.112280%]
|---compare (): 2.957078s [8.537197%]
       34.64 real        33.47 user         0.72 sys</code></pre>
<p></details></p>
<p><details> <summary> after </summary></p>
<pre><code>|---Construct G () 2019-04-09 05:05:10 PM
 edges size 300470
 graph constructed
|---Encode () 2019-04-09 05:05:11 PM
|---|---Init compressed () 2019-04-09 05:05:11 PM
|---|---Extact edge types () 2019-04-09 05:05:11 PM
|---|---|---Extract messages () 2019-04-09 05:05:11 PM
|---|---|---|---graph_message::update_message init () 2019-04-09 05:05:11 PM
|---|---|---|---resizing messages () 2019-04-09 05:05:11 PM
|---|---|---|---initializing messages () 2019-04-09 05:05:11 PM
|---|---|---|---updating messages () 2019-04-09 05:05:11 PM
 total time to search in hash table: 0.755252
 total time to insert in hash table: 1.52036
 total time to modify vector m  0.79718
 total time to sort  0.07528
 total time to collect neighbor messages 0.752213
|---|---|---|---* symmetrizing () 2019-04-09 05:05:17 PM
|---|---|---|---setting message_mark and is_star_message () 2019-04-09 05:05:17 PM
|---|---|---colored_graph::init init () 2019-04-09 05:05:17 PM
|---|---|---updating adj_list () 2019-04-09 05:05:17 PM
|---|---|---Find deg and ver_types () 2019-04-09 05:05:18 PM
|---|---Encode * vertices () 2019-04-09 05:05:19 PM
|---|---Encode * edges () 2019-04-09 05:05:21 PM
|---|---Encode vertex types () 2019-04-09 05:05:21 PM
|---|---Extract partition graphs () 2019-04-09 05:05:24 PM
|---|---Encode partition b graphs () 2019-04-09 05:05:26 PM
|---|---Encode partition graphs () 2019-04-09 05:05:28 PM
|---Decode () 2019-04-09 05:05:29 PM
|---|---Init () 2019-04-09 05:05:29 PM
|---|---Decode * vertices () 2019-04-09 05:05:29 PM
|---|---Decode * edges () 2019-04-09 05:05:31 PM
|---|---Decode vertex types () 2019-04-09 05:05:31 PM
|---|---Decode partition graphs () 2019-04-09 05:05:38 PM
|---|---Decode partition b graphs () 2019-04-09 05:05:38 PM
|---|---Construct decoded graph () 2019-04-09 05:05:41 PM
|---compare () 2019-04-09 05:05:42 PM
 successfully decoded the marked graph :D

|---Construct G (): 0.956205s [2.775045%]
|---Encode (): 17.612391s [51.113735%]
|---|---Init compressed (): 0.000653s [0.003709%]
|---|---Extact edge types (): 7.961563s [45.204330%]
|---|---|---Extract messages (): 6.084527s [76.423775%]
|---|---|---|---graph_message::update_message init (): 0.001444s [0.023740%]
|---|---|---|---resizing messages (): 0.192311s [3.160649%]
|---|---|---|---initializing messages (): 0.187849s [3.087325%]
|---|---|---|---updating messages (): 5.632613s [92.572739%]
|---|---|---|---* symmetrizing (): 0.032790s [0.538907%]
|---|---|---|---setting message_mark and is_star_message (): 0.037503s [0.616363%]
|---|---|---colored_graph::init init (): 0.214541s [2.694708%]
|---|---|---updating adj_list (): 0.395865s [4.972202%]
|---|---|---Find deg and ver_types (): 1.266586s [15.908758%]
|---|---Encode * vertices (): 2.331242s [13.236377%]
|---|---Encode * edges (): 0.000055s [0.000311%]
|---|---Encode vertex types (): 2.293806s [13.023817%]
|---|---Extract partition graphs (): 2.750105s [15.614605%]
|---|---Encode partition b graphs (): 2.096790s [11.905195%]
|---|---Encode partition graphs (): 0.176885s [1.004324%]
|---Decode (): 12.922110s [37.501854%]
|---|---Init (): 0.000021s [0.000161%]
|---|---Decode * vertices (): 2.465586s [19.080364%]
|---|---Decode * edges (): 0.000037s [0.000283%]
|---|---Decode vertex types (): 6.388016s [49.434776%]
|---|---Decode partition graphs (): 0.000078s [0.000603%]
|---|---Decode partition b graphs (): 3.535769s [27.362165%]
|---|---Construct decoded graph (): 0.532570s [4.121383%]
|---compare (): 2.966536s [8.609321%]
       34.46 real        33.37 user         0.72 sys</code></pre>
<p></details></p>
<h2 id="pm-1">2019-04-09 9:17 PM</h2>
<p>Realized that it is not really necessary to work with <code>adj_location</code> which is a complex map structure in marked graphs. Instead, defined <code>index_in_neighbor</code>: for a vertex v, <code>index_in_neighbor[v][i]</code> is the index of v in the adjacency list of the ith neighbor of v. With this, only modifying update message, I had a ~0.5 s improvement:</p>
<h2 id="am">2019-04-10 11:50 AM</h2>
<p>Removed the attribute <code>adj_location</code> from both marked graph and colored graph, and used <code>index_in_neighbor</code> in all places. This results in ~2 s improvement:</p>
<p><details></p>
<p><summary> details </summary></p>
<pre><code>|---Construct G () 2019-04-10 11:43:03 AM
 edges size 300440
 graph constructed
|---Encode () 2019-04-10 11:43:04 AM
|---|---Init compressed () 2019-04-10 11:43:04 AM
|---|---Extact edge types () 2019-04-10 11:43:04 AM
|---|---|---Extract messages () 2019-04-10 11:43:04 AM
|---|---|---|---graph_message::update_message init () 2019-04-10 11:43:04 AM
|---|---|---|---resizing messages () 2019-04-10 11:43:04 AM
|---|---|---|---initializing messages () 2019-04-10 11:43:04 AM
|---|---|---|---updating messages () 2019-04-10 11:43:04 AM
 total time to search in hash table: 0.760559
 total time to insert in hash table: 1.55026
 total time to modify vector m  0.784155
 total time to sort  0.0688325
 total time to collect neighbor messages 0.41188
|---|---|---|---* symmetrizing () 2019-04-10 11:43:10 AM
|---|---|---|---setting message_mark and is_star_message () 2019-04-10 11:43:10 AM
|---|---|---colored_graph::init init () 2019-04-10 11:43:10 AM
|---|---|---updating adj_list () 2019-04-10 11:43:10 AM
|---|---|---Find deg and ver_types () 2019-04-10 11:43:10 AM
|---|---Encode * vertices () 2019-04-10 11:43:11 AM
|---|---Encode * edges () 2019-04-10 11:43:13 AM
|---|---Encode vertex types () 2019-04-10 11:43:13 AM
|---|---Extract partition graphs () 2019-04-10 11:43:16 AM
|---|---Encode partition b graphs () 2019-04-10 11:43:18 AM
|---|---Encode partition graphs () 2019-04-10 11:43:20 AM
|---Decode () 2019-04-10 11:43:21 AM
|---|---Init () 2019-04-10 11:43:21 AM
|---|---Decode * vertices () 2019-04-10 11:43:21 AM
|---|---Decode * edges () 2019-04-10 11:43:23 AM
|---|---Decode vertex types () 2019-04-10 11:43:23 AM
|---|---Decode partition graphs () 2019-04-10 11:43:29 AM
|---|---Decode partition b graphs () 2019-04-10 11:43:29 AM
|---|---Construct decoded graph () 2019-04-10 11:43:32 AM
|---compare () 2019-04-10 11:43:33 AM
 successfully decoded the marked graph :D

|---Construct G (): 0.829669s [2.594985%]
|---Encode (): 16.433228s [51.398804%]
|---|---Init compressed (): 0.000718s [0.004366%]
|---|---Extact edge types (): 7.172252s [43.644817%]
|---|---|---Extract messages (): 5.716563s [79.703888%]
|---|---|---|---graph_message::update_message init (): 0.001409s [0.024649%]
|---|---|---|---resizing messages (): 0.191876s [3.356501%]
|---|---|---|---initializing messages (): 0.179843s [3.145999%]
|---|---|---|---updating messages (): 5.273019s [92.241066%]
|---|---|---|---* symmetrizing (): 0.032299s [0.565013%]
|---|---|---|---setting message_mark and is_star_message (): 0.037780s [0.660887%]
|---|---|---colored_graph::init init (): 0.024582s [0.342731%]
|---|---|---updating adj_list (): 0.220640s [3.076303%]
|---|---|---Find deg and ver_types (): 1.210425s [16.876507%]
|---|---Encode * vertices (): 2.164104s [13.169074%]
|---|---Encode * edges (): 0.000043s [0.000263%]
|---|---Encode vertex types (): 2.158486s [13.134887%]
|---|---Extract partition graphs (): 2.701006s [16.436249%]
|---|---Encode partition b graphs (): 2.064137s [12.560755%]
|---|---Encode partition graphs (): 0.171202s [1.041805%]
|---Decode (): 12.170957s [38.067539%]
|---|---Init (): 0.000023s [0.000190%]
|---|---Decode * vertices (): 2.286243s [18.784418%]
|---|---Decode * edges (): 0.000034s [0.000280%]
|---|---Decode vertex types (): 6.092728s [50.059563%]
|---|---Decode partition graphs (): 0.000061s [0.000503%]
|---|---Decode partition b graphs (): 3.370534s [27.693254%]
|---|---Construct decoded graph (): 0.421302s [3.461539%]
|---compare (): 2.538139s [7.938629%]
       31.98 real        31.27 user         0.58 sys</code></pre>
<p></details></p>
<h2 id="pm-2">2019-04-12 7:04 PM</h2>
<p>I realized that the inputs to the <code>compute_product</code> function do not need to be of type <code>mpz_class</code>, only <code>int</code> is enough. This surprisingly results in about 6s improvement!</p>
<p><details></p>
<p><summary> details </summary></p>
<p>Note that I commented the parts to compute total time to search in hash table etc.</p>
<pre><code>|---Construct G () 2019-04-12 07:00:18 PM
 edges size 300457
 graph constructed
|---Encode () 2019-04-12 07:00:19 PM
|---|---Init compressed () 2019-04-12 07:00:19 PM
|---|---Extact edge types () 2019-04-12 07:00:19 PM
|---|---|---Extract messages () 2019-04-12 07:00:19 PM
|---|---|---|---graph_message::update_message init () 2019-04-12 07:00:19 PM
|---|---|---|---resizing messages () 2019-04-12 07:00:19 PM
|---|---|---|---initializing messages () 2019-04-12 07:00:19 PM
|---|---|---|---updating messages () 2019-04-12 07:00:19 PM
 total time to search in hash table: 0
 total time to insert in hash table: 0
 total time to modify vector m  0
 total time to sort  0
 total time to collect neighbor messages 0
|---|---|---|---* symmetrizing () 2019-04-12 07:00:23 PM
|---|---|---|---setting message_mark and is_star_message () 2019-04-12 07:00:23 PM
|---|---|---colored_graph::init init () 2019-04-12 07:00:23 PM
|---|---|---updating adj_list () 2019-04-12 07:00:23 PM
|---|---|---Find deg and ver_types () 2019-04-12 07:00:23 PM
|---|---Encode * vertices () 2019-04-12 07:00:25 PM
|---|---Encode * edges () 2019-04-12 07:00:26 PM
|---|---Encode vertex types () 2019-04-12 07:00:26 PM
|---|---Extract partition graphs () 2019-04-12 07:00:27 PM
|---|---Encode partition b graphs () 2019-04-12 07:00:30 PM
|---|---Encode partition graphs () 2019-04-12 07:00:32 PM
|---Decode () 2019-04-12 07:00:32 PM
|---|---Init () 2019-04-12 07:00:32 PM
|---|---Decode * vertices () 2019-04-12 07:00:32 PM
|---|---Decode * edges () 2019-04-12 07:00:33 PM
|---|---Decode vertex types () 2019-04-12 07:00:33 PM
|---|---Decode partition graphs () 2019-04-12 07:00:37 PM
|---|---Decode partition b graphs () 2019-04-12 07:00:37 PM
|---|---Construct decoded graph () 2019-04-12 07:00:40 PM
|---compare () 2019-04-12 07:00:41 PM
 successfully decoded the marked graph :D

|---Construct G (): 0.838441s [3.293217%]
|---Encode (): 13.342818s [52.407761%]
|---|---Init compressed (): 0.000688s [0.005153%]
|---|---Extact edge types (): 6.134593s [45.976738%]
|---|---|---Extract messages (): 4.592058s [74.855133%]
|---|---|---|---graph_message::update_message init (): 0.001506s [0.032806%]
|---|---|---|---resizing messages (): 0.194764s [4.241329%]
|---|---|---|---initializing messages (): 0.193184s [4.206914%]
|---|---|---|---updating messages (): 4.128408s [89.903221%]
|---|---|---|---* symmetrizing (): 0.034695s [0.755551%]
|---|---|---|---setting message_mark and is_star_message (): 0.039188s [0.853394%]
|---|---|---colored_graph::init init (): 0.027730s [0.452019%]
|---|---|---updating adj_list (): 0.236458s [3.854509%]
|---|---|---Find deg and ver_types (): 1.278302s [20.837597%]
|---|---Encode * vertices (): 1.130349s [8.471589%]
|---|---Encode * edges (): 0.000045s [0.000334%]
|---|---Encode vertex types (): 1.154480s [8.652441%]
|---|---Extract partition graphs (): 2.733744s [20.488504%]
|---|---Encode partition b graphs (): 2.016023s [15.109422%]
|---|---Encode partition graphs (): 0.171038s [1.281871%]
|---Decode (): 8.703982s [34.187397%]
|---|---Init (): 0.000019s [0.000223%]
|---|---Decode * vertices (): 1.197001s [13.752331%]
|---|---Decode * edges (): 0.000042s [0.000481%]
|---|---Decode vertex types (): 3.619471s [41.584076%]
|---|---Decode partition graphs (): 0.000045s [0.000514%]
|---|---Decode partition b graphs (): 3.433578s [39.448360%]
|---|---Construct decoded graph (): 0.453796s [5.213660%]
|---compare (): 2.574372s [10.111587%]
       25.47 real        24.60 user         0.60 sys</code></pre>
<p></details></p>
<h2 id="pm-3">2019-04-12 7:12 PM</h2>
<p>I also tried to see if another way of splitting the terms for <code>compute_product</code> can result in an improvement. The other form (see handwritten note for details) is as follows:</p>
<p><span class="math">\[ \prod_{i=0}^{k-1} (r - is) = \prod_{i=0}^{\lceil k / 2 \rceil - 1} (r - i(2s)) \times \prod_{i=0}^{\lfloor k / 2 \rfloor - 1} ((r-s) - i(2s))\]</span></p>
<p>Which means that <span class="math">\(\text{compute_product}(r, k, s) = \text{compute_product}(r, m, 2s) \times \text{compute_product}(r-s, k-m, 2s)\)</span> where <span class="math">\(m = (k+1) \div 2\)</span>. I tested this, but did not see an improvement. I expected one, because this is a more balanced split.</p>
<p><details></p>
<p><summary> details </summary></p>
<pre><code>|---Construct G () 2019-04-12 07:11:21 PM
 edges size 299838
 graph constructed
|---Encode () 2019-04-12 07:11:21 PM
|---|---Init compressed () 2019-04-12 07:11:21 PM
|---|---Extact edge types () 2019-04-12 07:11:21 PM
|---|---|---Extract messages () 2019-04-12 07:11:21 PM
|---|---|---|---graph_message::update_message init () 2019-04-12 07:11:21 PM
|---|---|---|---resizing messages () 2019-04-12 07:11:21 PM
|---|---|---|---initializing messages () 2019-04-12 07:11:22 PM
|---|---|---|---updating messages () 2019-04-12 07:11:22 PM
 total time to search in hash table: 0
 total time to insert in hash table: 0
 total time to modify vector m  0
 total time to sort  0
 total time to collect neighbor messages 0
|---|---|---|---* symmetrizing () 2019-04-12 07:11:26 PM
|---|---|---|---setting message_mark and is_star_message () 2019-04-12 07:11:26 PM
|---|---|---colored_graph::init init () 2019-04-12 07:11:26 PM
|---|---|---updating adj_list () 2019-04-12 07:11:26 PM
|---|---|---Find deg and ver_types () 2019-04-12 07:11:26 PM
|---|---Encode * vertices () 2019-04-12 07:11:28 PM
|---|---Encode * edges () 2019-04-12 07:11:29 PM
|---|---Encode vertex types () 2019-04-12 07:11:29 PM
|---|---Extract partition graphs () 2019-04-12 07:11:30 PM
|---|---Encode partition b graphs () 2019-04-12 07:11:33 PM
|---|---Encode partition graphs () 2019-04-12 07:11:35 PM
|---Decode () 2019-04-12 07:11:35 PM
|---|---Init () 2019-04-12 07:11:35 PM
|---|---Decode * vertices () 2019-04-12 07:11:35 PM
|---|---Decode * edges () 2019-04-12 07:11:36 PM
|---|---Decode vertex types () 2019-04-12 07:11:36 PM
|---|---Decode partition graphs () 2019-04-12 07:11:40 PM
|---|---Decode partition b graphs () 2019-04-12 07:11:40 PM
|---|---Construct decoded graph () 2019-04-12 07:11:43 PM
|---compare () 2019-04-12 07:11:43 PM
 successfully decoded the marked graph :D

|---Construct G (): 0.846560s [3.329669%]
|---Encode (): 13.309370s [52.348114%]
|---|---Init compressed (): 0.000787s [0.005912%]
|---|---Extact edge types (): 6.099671s [45.829899%]
|---|---|---Extract messages (): 4.611472s [75.601974%]
|---|---|---|---graph_message::update_message init (): 0.001362s [0.029537%]
|---|---|---|---resizing messages (): 0.192514s [4.174665%]
|---|---|---|---initializing messages (): 0.190769s [4.136829%]
|---|---|---|---updating messages (): 4.160253s [90.215286%]
|---|---|---|---* symmetrizing (): 0.029564s [0.641104%]
|---|---|---|---setting message_mark and is_star_message (): 0.036786s [0.797699%]
|---|---|---colored_graph::init init (): 0.025158s [0.412448%]
|---|---|---updating adj_list (): 0.228830s [3.751512%]
|---|---|---Find deg and ver_types (): 1.234159s [20.233212%]
|---|---Encode * vertices (): 1.139122s [8.558794%]
|---|---Encode * edges (): 0.000050s [0.000373%]
|---|---Encode vertex types (): 1.177471s [8.846930%]
|---|---Extract partition graphs (): 2.741612s [20.599110%]
|---|---Encode partition b graphs (): 1.975690s [14.844354%]
|---|---Encode partition graphs (): 0.173620s [1.304497%]
|---Decode (): 8.671961s [34.108360%]
|---|---Init (): 0.000020s [0.000227%]
|---|---Decode * vertices (): 1.194511s [13.774403%]
|---|---Decode * edges (): 0.000037s [0.000429%]
|---|---Decode vertex types (): 3.631156s [41.872372%]
|---|---Decode partition graphs (): 0.000049s [0.000569%]
|---|---Decode partition b graphs (): 3.408437s [39.304111%]
|---|---Construct decoded graph (): 0.437722s [5.047554%]
|---compare (): 2.596835s [10.213815%]
       25.43 real        24.67 user         0.57 sys</code></pre>
<p></details></p>
<h2 id="pm-4">2019-04-16 5:40 PM</h2>
<p>Realized that there is a more efficient way of updating messages: when we gather previous messages and sort them, we do not need to construct a vector for each neighbor separately, we can swap the last element one by one to find the message. This is done by working with capacity and size, so that we keep the element of the message that we do not need at the end of the vector outside its size so that we can use it later by swapping.</p>
<p>Also, I realized that we do not need to keep a list of all messages, the only information we need is whether a message is star type and its mark component.</p>
<p>Also, we do not need to keep a copy of message_dict and messages for all depths, as at depth s we only need depth s-1, so at each depth, we can get a backup of current variables and clear them and update them using this backup (which refers to the previous depth).</p>
<p>With all these, I seem to have an improvement of around 1s, but I expected at least 3s! Now, for 100,000 nodes, 300,000 edges, h = 3, delta = 20. Here is details:</p>
<p><details></p>
<p><summary> details </summary></p>
<pre><code>|---Construct G () 2019-04-16 05:28:48 PM
 edges size 299124
 graph constructed
|---Encode () 2019-04-16 05:28:49 PM
|---|---Init compressed () 2019-04-16 05:28:49 PM
|---|---Extact edge types () 2019-04-16 05:28:49 PM
|---|---|---Extract messages () 2019-04-16 05:28:49 PM
|---|---|---|---graph_message::update_message init () 2019-04-16 05:28:49 PM
|---|---|---|---resizing messages () 2019-04-16 05:28:49 PM
|---|---|---|---initializing messages () 2019-04-16 05:28:49 PM
|---|---|---|---updating messages () 2019-04-16 05:28:49 PM
|---|---|---|---* symmetrizing () 2019-04-16 05:28:53 PM
|---|---|---colored_graph::init init () 2019-04-16 05:28:53 PM
|---|---|---updating adj_list () 2019-04-16 05:28:53 PM
|---|---|---Find deg and ver_types () 2019-04-16 05:28:53 PM
|---|---Encode * vertices () 2019-04-16 05:28:54 PM
|---|---Encode * edges () 2019-04-16 05:28:56 PM
|---|---Encode vertex types () 2019-04-16 05:28:56 PM
|---|---Extract partition graphs () 2019-04-16 05:28:57 PM
|---|---Encode partition b graphs () 2019-04-16 05:29:00 PM
|---|---Encode partition graphs () 2019-04-16 05:29:01 PM
|---Decode () 2019-04-16 05:29:02 PM
|---|---Init () 2019-04-16 05:29:02 PM
|---|---Decode * vertices () 2019-04-16 05:29:02 PM
|---|---Decode * edges () 2019-04-16 05:29:03 PM
|---|---Decode vertex types () 2019-04-16 05:29:03 PM
|---|---Decode partition graphs () 2019-04-16 05:29:06 PM
|---|---Decode partition b graphs () 2019-04-16 05:29:06 PM
|---|---Construct decoded graph () 2019-04-16 05:29:10 PM
|---compare () 2019-04-16 05:29:10 PM
 successfully decoded the marked graph :D

|---Construct G (): 0.853117s [3.544942%]
|---Encode (): 12.856951s [53.424271%]
|---|---Init compressed (): 0.000504s [0.003918%]
|---|---Extact edge types (): 5.701544s [44.346008%]
|---|---|---Extract messages (): 4.292262s [75.282448%]
|---|---|---|---graph_message::update_message init (): 0.001364s [0.031769%]
|---|---|---|---resizing messages (): 0.025791s [0.600883%]
|---|---|---|---initializing messages (): 0.179556s [4.183252%]
|---|---|---|---updating messages (): 3.769229s [87.814514%]
|---|---|---|---* symmetrizing (): 0.316306s [7.369211%]
|---|---|---colored_graph::init init (): 0.022788s [0.399686%]
|---|---|---updating adj_list (): 0.163689s [2.870965%]
|---|---|---Find deg and ver_types (): 1.222781s [21.446480%]
|---|---Encode * vertices (): 1.128720s [8.779068%]
|---|---Encode * edges (): 0.000044s [0.000342%]
|---|---Encode vertex types (): 1.150674s [8.949819%]
|---|---Extract partition graphs (): 2.728767s [21.224064%]
|---|---Encode partition b graphs (): 1.966031s [15.291584%]
|---|---Encode partition graphs (): 0.179268s [1.394325%]
|---Decode (): 8.595399s [35.716316%]
|---|---Init (): 0.000018s [0.000204%]
|---|---Decode * vertices (): 1.209178s [14.067740%]
|---|---Decode * edges (): 0.000051s [0.000593%]
|---|---Decode vertex types (): 3.569625s [41.529484%]
|---|---Decode partition graphs (): 0.000054s [0.000633%]
|---|---Decode partition b graphs (): 3.373827s [39.251541%]
|---|---Construct decoded graph (): 0.442614s [5.149432%]
|---compare (): 1.760271s [7.314426%]
       24.07 real        23.38 user         0.50 sys</code></pre>
<p></details></p>
<p>I am starting to think that perhaps I am expecting too much. This is somehow the maximum entropy ensemble and perhaps that's why it takes this much time. For other types of data, e.g. more symmetric ones, perhaps we can be faster. The reason for this: among the ~300,000 edges and 600,000 half edges, almost all of them have a unique type, more specifically, in an example, the graph has 299,768 edges and 598,135 type, so nearly the maximum, and this is because there is no symmetry in the graph. Maybe I should run it and test it in different examples. Yet the idea of multithreading exists, but that might be a little difficult.</p>
<p>Don't forget to commit.</p>
</body>
</html>
